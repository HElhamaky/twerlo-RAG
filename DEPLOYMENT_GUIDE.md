# Deploy to Render.com

This guide will help you deploy your Twerlo application to Render.com.

## Prerequisites

1. **GitHub Repository**: Your code should be in a GitHub repository
2. **Render.com Account**: Sign up at [render.com](https://render.com)

## Step 1: Prepare Your Repository

Make sure your repository contains these files:
- `Dockerfile` - Multi-stage Docker build
- `docker-compose.yml` - Local development setup
- `render.yaml` - Render.com configuration
- `start.sh` - Production startup script
- `requirements.txt` - Python dependencies
- `frontend/package.json` - Node.js dependencies

## Step 2: Deploy to Render.com

### Option A: Using render.yaml (Recommended)

1. **Connect Repository**:
   - Go to [render.com/dashboard](https://dashboard.render.com)
   - Click "New +" â†’ "Web Service"
   - Connect your GitHub repository

2. **Configure Service**:
   - **Name**: `twerlo-app`
   - **Environment**: `Docker`
   - **Region**: Choose closest to your users
   - **Branch**: `main` (or your default branch)
   - **Root Directory**: Leave empty (root of repo)

3. **Environment Variables** (Optional - Render will use render.yaml):
   ```
   NODE_ENV=production
   NEXT_TELEMETRY_DISABLED=1
   DATABASE_URL=sqlite:///./data/twerlo.db
   SECRET_KEY=<auto-generated>
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=30
   CORS_ORIGINS=https://your-app-name.onrender.com
   ```

4. **Deploy**:
   - Click "Create Web Service"
   - Render will automatically build and deploy your application

### Option B: Manual Configuration

1. **Create Web Service**:
   - Name: `twerlo-app`
   - Environment: `Docker`
   - Build Command: `docker build -t twerlo-app .`
   - Start Command: `./start.sh`

2. **Environment Variables**:
   ```
   NODE_ENV=production
   NEXT_TELEMETRY_DISABLED=1
   DATABASE_URL=sqlite:///./data/twerlo.db
   SECRET_KEY=<generate-secure-key>
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=30
   CORS_ORIGINS=https://your-app-name.onrender.com
   ```

## Step 3: Update Frontend Configuration

After deployment, update your frontend environment:

1. **Create `.env.local` in frontend directory**:
   ```
   NEXT_PUBLIC_API_URL=https://your-app-name.onrender.com
   ```

2. **Or set in Render Dashboard**:
   - Go to your service settings
   - Add environment variable: `NEXT_PUBLIC_API_URL=https://your-app-name.onrender.com`

## Step 4: Verify Deployment

1. **Check Health**: Visit your app URL (e.g., `https://twerlo-app.onrender.com`)
2. **Test Features**:
   - User registration/login
   - File upload
   - Chat functionality

## Important Notes

### Database Persistence
- **SQLite**: Data will be lost on service restarts
- **For Production**: Consider using PostgreSQL or MongoDB
- **File Storage**: Consider using cloud storage (AWS S3, etc.)

### CORS Configuration
- Update `CORS_ORIGINS` in your backend to include your Render URL
- Example: `https://your-app-name.onrender.com`

### Environment Variables
- `SECRET_KEY`: Generate a secure random string
- `DATABASE_URL`: Use external database for production
- `CORS_ORIGINS`: Your Render app URL

## Troubleshooting

### Build Failures
1. **Check Logs**: View build logs in Render dashboard
2. **Docker Issues**: Ensure Dockerfile is valid
3. **Dependencies**: Verify all dependencies are in requirements.txt

### Runtime Issues
1. **Port Configuration**: Ensure app listens on `$PORT`
2. **Database**: Check database connection
3. **CORS**: Verify CORS settings match your domain

### Performance
1. **Cold Starts**: Render has cold start delays
2. **Memory**: Monitor memory usage
3. **Scaling**: Consider upgrading plan for better performance

## Production Considerations

### Security
- Use strong `SECRET_KEY`
- Enable HTTPS (automatic on Render)
- Implement rate limiting
- Add input validation

### Monitoring
- Set up logging
- Monitor error rates
- Track performance metrics

### Scaling
- Consider database scaling
- Implement caching
- Use CDN for static assets

## Support

- **Render Documentation**: [docs.render.com](https://docs.render.com)
- **Docker Documentation**: [docs.docker.com](https://docs.docker.com)
- **Next.js Deployment**: [nextjs.org/docs/deployment](https://nextjs.org/docs/deployment)

## Example URLs

After deployment, your app will be available at:
- **Frontend**: `https://your-app-name.onrender.com`
- **API**: `https://your-app-name.onrender.com/api/*`
- **Health Check**: `https://your-app-name.onrender.com/`

## Environment Variables Reference

| Variable | Description | Default |
|----------|-------------|---------|
| `NODE_ENV` | Node.js environment | `production` |
| `NEXT_TELEMETRY_DISABLED` | Disable Next.js telemetry | `1` |
| `DATABASE_URL` | Database connection string | `sqlite:///./data/twerlo.db` |
| `SECRET_KEY` | JWT secret key | Auto-generated |
| `ALGORITHM` | JWT algorithm | `HS256` |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Token expiration | `30` |
| `CORS_ORIGINS` | Allowed origins | Your Render URL |
| `NEXT_PUBLIC_API_URL` | Frontend API URL | `http://localhost:8000` | 